<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="description" content="Data Visualisation Exercise 1" />
    <meta name="keywords" content="HTML, CSS, D3" />
    <meta name="author" content="Jericho Black" />
    <title>Data Visualisation Exercise</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
        }

        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            font-size: 30px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
        }

        .dropdown-container {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
        }

        .dropdown {
            width: 100%;
            max-width: 300px;
        }

        .dropdown label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .dropdown input {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            border-radius: 4px;
            border: 2px solid #ddd;
            background-color: #fff;
        }

        .chart-container {
            display: flex;
            justify-content: space-between;
        }

        svg {
            display: flex;
            border-radius: 8px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Line Graph of Health Status Improvement Across Years</h1>
        <div class="dropdown-container">
            <div class="dropdown">
                <label for="country-select1">Select Country for Chart 1:</label>
                <input list="countries" id="country-select1" placeholder="Search for a country"
                    oninput="updateChart('chart1', this.value)" />
            </div>
            <div class="dropdown">
                <label for="country-select2">Select Country for Chart 2:</label>
                <input list="countries" id="country-select2" placeholder="Search for a country"
                    oninput="updateChart('chart2', this.value)" />
            </div>
            <datalist id="countries">
                <option value="Austria"></option>
                <option value="Belgium"></option>
                <option value="Czechia"></option>
                <option value="Estonia"></option>
                <option value="Finland"></option>
                <option value="France"></option>
                <option value="Germany"></option>
                <option value="Greece"></option>
                <option value="Hungary"></option>
                <option value="Iceland"></option>
                <option value="Israel"></option>
                <option value="Italy"></option>
                <option value="Latvia"></option>
                <option value="Lithuania"></option>
                <option value="Luxembourg"></option>
                <option value="Netherlands"></option>
                <option value="Norway"></option>
                <option value="Poland"></option>
                <option value="Portugal"></option>
                <option value="Slovak Republic"></option>
                <option value="Slovenia"></option>
                <option value="Spain"></option>
                <option value="Sweden"></option>
                <option value="Switzerland"></option>
                <option value="Turkiye"></option>
                <option value="United Kingdom"></option>
                <option value="Canada"></option>
                <option value="United States"></option>
                <option value="New Zealand"></option>
            </datalist>
        </div>
        <div class="chart-container">
            <div id="chart1"></div>
            <div id="chart2"></div>
        </div>
    </div>

    <script>
        var color = d3.scaleOrdinal()
            .domain(["bottomQuintile", "topQuintile"])
            .range(["#32c6b5", "#ff7f0e"]);

        var height = 500;
        var width = 500;
        var padding = 60;

        function fetchData(country, callback) {
            d3.csv("HealthStatusOECD.csv", function (d) {
                return {
                    year: +d.Year,
                    bottomQuintile: d[country + "BQ"] !== ".." ? +d[country + "BQ"] : null,
                    topQuintile: d[country + "TQ"] !== ".." ? +d[country + "TQ"] : null,
                };
            }).then(callback).catch(function (error) {
                console.error('Error loading or parsing data:', error);
            });
        }

        function updateChart(chartId, country) {
            fetchData(country, function (data) {
                console.log(`Updating ${chartId} for ${country}`);
                d3.select(`#${chartId}`).html(""); // Clear existing content

                var svg = d3.select(`#${chartId}`)
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height);

                var xScale = d3.scaleLinear()
                    .domain(d3.extent(data, function (d) { return d.year; }))
                    .range([padding, width - padding]);

                svg.append("g")
                    .attr("transform", `translate(0, ${height - padding})`)
                    .call(d3.axisBottom(xScale).ticks(5));

                var yScale = d3.scaleLinear()
                    .domain([0, 100])
                    .range([height - padding, padding]);

                svg.append("g")
                    .attr("transform", `translate(${padding}, 0)`)
                    .call(d3.axisLeft(yScale));

                // Append Y Axis Title
                svg.append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 0)
                    .attr("x", 0 - (height / 2) + 10)
                    .attr("dy", "1em")
                    .attr("font-family", "Arial")
                    .attr("font-size", "12px")
                    .attr("fill", "black")
                    .style("text-anchor", "middle")
                    .text("Percentage with perceived 'good' health status");

                // Append X Axis Title
                svg.append("text")
                    .attr("y", height - (padding / 2))
                    .attr("x", width / 2)
                    .attr("dy", "1em")
                    .attr("font-family", "Arial")
                    .attr("font-size", "12px")
                    .attr("fill", "black")
                    .style("text-anchor", "middle")
                    .text("Year");

                // Append a legend to the top of the SVG
                var legend = svg.append("g")
                    .attr("class", "legend")
                    .attr("transform", "translate(" + (width - 100) + "," + 20 + ")");

                legend.selectAll("rect")
                    .data(["topQuintile", "bottomQuintile"])
                    .enter()
                    .append("rect")
                    .attr("x", 0)
                    .attr("y", function (d, i) { return i * 20; })
                    .attr("width", 10)
                    .attr("height", 10)
                    .attr("fill", color);

                legend.selectAll("text")
                    .data(["Top Quintile", "Bottom Quintile"])
                    .enter()
                    .append("text")
                    .attr("x", 15)
                    .attr("y", function (d, i) { return i * 20 + 6; })
                    .attr("dy", ".35em")
                    .style("font-size", "10px")
                    .text(function (d) { return d; });

                ["bottomQuintile", "topQuintile"].forEach(function (quintile) {
                    svg.append("path")
                        .datum(data)
                        .attr("fill", "none")
                        .attr("stroke", color(quintile))
                        .attr("stroke-width", 2)
                        .attr("d", d3.line()
                            .defined(function (d) { return d[quintile] !== null; })
                            .x(function (d) { return xScale(d.year); })
                            .y(function (d) { return yScale(d[quintile]); })
                        );

                    svg.selectAll(`dot.${quintile}`)
                        .data(data.filter(d => d[quintile] !== null))
                        .enter()
                        .append("circle")
                        .attr("fill", color(quintile))
                        .attr("cx", function (d) { return xScale(d.year); })
                        .attr("cy", function (d) { return yScale(d[quintile]); })
                        .attr("r", 5)
                        .on("mouseover", function (event, d) {
                            var xPosition = parseFloat(d3.select(this).attr("cx"));
                            var yPosition = parseFloat(d3.select(this).attr("cy"));

                            var tooltipText = `Year: ${d.year}, ${d[quintile]}%`;
                            var textWidth = tooltipText.length * 6; // Approximate width calculation
                            var textHeight = 18; // Approximate height

                            svg.append("rect")
                                .attr("id", "tooltip-bg")
                                .attr("x", xPosition + 5)
                                .attr("y", yPosition - textHeight)
                                .attr("width", textWidth)
                                .attr("height", textHeight)
                                .attr("fill", "white")
                                .attr("stroke", "black");

                            svg.append("text")
                                .attr("id", "tooltip-text")
                                .attr("x", xPosition + 10)
                                .attr("y", yPosition - 5)
                                .text(tooltipText)
                                .attr("font-family", "Arial")
                                .attr("font-size", "12px")
                                .attr("fill", "black");

                            d3.select(this)
                                .transition()
                                .duration(200)
                                .attr("fill", "orange");
                        })
                        .on("mouseout", function (d) {
                            d3.select("#tooltip-bg").remove();
                            d3.select("#tooltip-text").remove();
                            d3.select(this)
                                .transition()
                                .duration(200)
                                .attr("fill", color(quintile));
                        });
                });
            });
        }
    </script>
</body>

</html>